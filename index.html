<!DOCTYPE html>
<html lang="en">
<head>
 <link rel="icon" href="Images/Icons/favicon.ico" type="image/ico">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BGSI Chance Calculator</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .world-button {
      min-height: 50px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: box-shadow 0.3s ease;
    }

    .world-button.active {
      box-shadow: 0 0 10px #fdffb6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>BGSI Chance Calculator</h1>
    <p>Calculator for BGSI legendaries and secret pets chances, easy to use, just enter the luck multiplier and see the chances</p>

    <div class="world-buttons" style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
      <input type="text" id="search-bar" placeholder="Search eggs or pets..." style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; width: 150px;" oninput="searchEggsAndPets()">
      <button class="world-button overworld" onclick="filterEggsByWorld('1')">
        <img src="Images/Icons/The_Overworld_Icon.webp" alt="Overworld Icon" style="vertical-align: middle; margin-right: 5px;"> Overworld
      </button>
      <button class="world-button minigame" onclick="filterEggsByWorld('2')">
        <img src="Images/Icons/Minigame_Paradise_Icon.webp" alt="Minigame Paradise Icon" style="vertical-align: middle; margin-right: 5px;"> Minigame Paradise
      </button>
      <button class="world-button event" onclick="filterEggsByWorld('bubble_festival')">
        <img src="Images/Icons/Bubble_Festival_Icon.webp" alt="Bubble Festival Icon" style="vertical-align: middle; margin-right: 5px;"> Bubble Festival
      </button>
    </div>

    <div id="egg-list"></div>
  </div>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Menu</h2>
    </div>
    <div class="sidebar-content">
      <a href="https://discord.gg/bubbler" class="discord-invite" target="_blank">
        <img src="Images/Icons/discord.ico" alt="Discord Icon">
      </a>
    </div>
    <button class="settings-button-sidebar" onclick="toggleSettingsPopup(event)" style="background: none; border: none; padding: 0; margin-bottom: 10px; cursor: pointer;">
      <img src="Images/Icons/settings.ico" alt="Settings Icon" style="width: 32px; height: 32px; display: block;">
    </button>
    <button class="credits-button-sidebar" onclick="showCreditsPopup(event)">Credits</button>
  </div>

  <div class="credits-popup" id="credits-popup">
    <p><strong>piczu123:</strong> Old site, not being maintained<br>
      <a href="https://piczu123.github.io/BGSI-Chance-Calculator/" target="_blank">
        <img src="Images/Icons/website.ico" alt="Website" style="vertical-align: middle; margin-right: 5px;"> https://piczu123.github.io/BGSI-Chance-Calculator/</a></p>
    <p><strong>BGSI wiki:</strong> Egg and Pet icons<br>
      <a href="https://bgs-infinity.fandom.com/" target="_blank">
        <img src="Images/Icons/website.ico" alt="Website" style="vertical-align: middle; margin-right: 5px;"> https://bgs-infinity.fandom.com/</a></p>
  </div>
<!-- For later -->
  <div class="settings-popup" id="settings-popup" style="display:none;">
    <h2>Settings</h2>
    <label for="font-select">Choose your font:</label>
    <select id="font-select">
      <option value="Arial">Arial (Default)</option>
      <option value="Ferdoka One">Ferdoka One</option>
      <option value="Lato">Lato</option>
      <option value="Helvetica">Helvetica</option>
      <option value="Roboto">Roboto</option>
    </select>
  </div>

  <button class="menu-icon" onclick="toggleSidebar()">
    <img src="Images/Icons/menu.ico" alt="Menu" />
  </button>

  <script src="script.js"></script>
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      } else {
        sidebar.classList.add('open');
      }
    }

    function showCreditsPopup(event) {
      event.preventDefault();
      event.stopPropagation();
      const popup = document.getElementById('credits-popup');
      popup.classList.add('show');
    }

    function hideCreditsPopup() {
      const popup = document.getElementById('credits-popup');
      popup.classList.remove('show');
    }

    function toggleSettingsPopup(event) {
      event.preventDefault();
      event.stopPropagation();
      const popup = document.getElementById('settings-popup');
      if (popup.style.display === 'block') {
        popup.style.display = 'none';
      } else {
        popup.style.display = 'block';
      }
    }

    // Font changing logic
    function setFont(font) {
      document.body.style.fontFamily = font;
      localStorage.setItem('selectedFont', font);
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Font select logic
      const fontSelect = document.getElementById('font-select');
      if (fontSelect) {
        // Load saved font
        const savedFont = localStorage.getItem('selectedFont') || 'Arial';
        fontSelect.value = savedFont;
        setFont(savedFont);
        fontSelect.addEventListener('change', function() {
          setFont(this.value);
        });
      }
    });

    function filterEggsByWorld(world) {
      const eggList = document.getElementById('egg-list');
      const eggs = eggList.querySelectorAll('.egg-card');

      // Get the currently active button
      const activeButton = document.querySelector('.world-button.active');

      // If the clicked button is already active, deselect it
      if (activeButton && activeButton.getAttribute('onclick').includes(world)) {
        activeButton.classList.remove('active');
        eggs.forEach(egg => egg.style.display = 'block'); // Show all eggs
        return;
      }

      // Remove active class from all world buttons
      document.querySelectorAll('.world-button').forEach(button => button.classList.remove('active'));

      // Add active class to the clicked button
      document.querySelector(`.world-button[onclick*="${world}"]`).classList.add('active');

      eggs.forEach(egg => {
        const eggWorld = egg.getAttribute('data-world');
        if (eggWorld === world) {
          egg.style.display = 'block';
        } else {
          egg.style.display = 'none';
        }
      });

      // Trigger search to reapply the filter
      searchEggsAndPets();
    }

    function searchEggsAndPets() {
      const searchTerm = document.getElementById('search-bar').value.toLowerCase();
      const eggList = document.getElementById('egg-list');
      const eggs = eggList.querySelectorAll('.egg-card');

      // Get the currently selected world filter
      const selectedWorld = document.querySelector('.world-button.active')?.getAttribute('onclick')?.match(/\('(.*?)'\)/)?.[1];

      eggs.forEach(egg => {
        const eggName = egg.querySelector('.egg-header h2').textContent.toLowerCase();
        const petNames = Array.from(egg.querySelectorAll('.pet-name')).map(pet => pet.textContent.toLowerCase());
        const eggWorld = egg.getAttribute('data-world');

        // Check if the egg matches the search term and the selected world filter
        const matchesSearch = eggName.includes(searchTerm) || petNames.some(petName => petName.includes(searchTerm));
        const matchesWorld = !selectedWorld || eggWorld === selectedWorld;

        if (matchesSearch && matchesWorld) {
          egg.style.display = 'block';
        } else {
          egg.style.display = 'none';
        }
      });
    }

    document.addEventListener('click', (event) => {
      const sidebar = document.getElementById('sidebar');
      const menuIcon = document.querySelector('.menu-icon');
      const popup = document.getElementById('credits-popup');
      const creditsButton = document.querySelector('.credits-button-sidebar');
      const settingsPopup = document.getElementById('settings-popup');
      const settingsButton = document.querySelector('.settings-button-sidebar');

      if (!sidebar.contains(event.target) && !menuIcon.contains(event.target)) {
        sidebar.classList.remove('open');
      }

      if (
        popup &&
        !popup.contains(event.target) &&
        !creditsButton.contains(event.target) &&
        !event.target.closest('.credits-button-sidebar')
      ) {
        hideCreditsPopup();
      }

      if (
        settingsPopup &&
        !settingsPopup.contains(event.target) &&
        !settingsButton.contains(event.target) &&
        !event.target.closest('.settings-button-sidebar')
      ) {
        settingsPopup.style.display = 'none';
      }
    });

    document.getElementById('sidebar').addEventListener('click', (event) => {
      event.stopPropagation();
    });

    document.querySelector('.credits-button-sidebar').addEventListener('mouseenter', (event) => {
      showCreditsPopup(event);
    });

    document.querySelector('.credits-popup').addEventListener('mouseleave', () => {
      hideCreditsPopup();
    });
  </script>
</body>
</html>
